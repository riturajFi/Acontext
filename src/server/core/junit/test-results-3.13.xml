<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="2" skipped="0" tests="153" time="35.722" timestamp="2025-12-22T09:26:09.046061+05:30" hostname="riturajtripathy-IdeaPad-Slim-3-15ABR8-1"><testcase classname="tests.deps.test_block_embedding" name="test_block_embedding_create_and_basic_queries" time="0.394" /><testcase classname="tests.deps.test_block_embedding" name="test_block_embedding_relationships" time="0.243" /><testcase classname="tests.deps.test_block_embedding" name="test_block_embedding_vector_similarity_search" time="0.214" /><testcase classname="tests.deps.test_block_embedding" name="test_block_embedding_cascade_delete" time="0.228" /><testcase classname="tests.deps.test_block_embedding" name="test_block_embedding_multiple_embeddings_per_block" time="0.209" /><testcase classname="tests.deps.test_block_reference" name="test_block_reference_set_null_on_delete" time="0.324" /><testcase classname="tests.deps.test_block_reference" name="test_tool_reference_sop_count" time="0.278" /><testcase classname="tests.deps.test_db" name="test_db" time="0.241" /><testcase classname="tests.deps.test_metrics" name="test_capture_increment_creates_and_increments_metric" time="0.424" /><testcase classname="tests.deps.test_redis" name="test_redis_basic_operations" time="0.014" /><testcase classname="tests.deps.test_redis" name="test_redis_connection" time="0.010" /><testcase classname="tests.deps.test_s3" name="test_s3" time="0.245" /><testcase classname="tests.llm.test_sop_customization.TestSOPPromptCustomization" name="test_build_custom_scoring_section_empty" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestSOPPromptCustomization" name="test_build_custom_scoring_section_normal" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestSOPPromptCustomization" name="test_build_custom_scoring_section_critical" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestSOPPromptCustomization" name="test_build_custom_scoring_section_mixed" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestSOPPromptCustomization" name="test_get_all_rule_indices_no_custom" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestSOPPromptCustomization" name="test_get_all_rule_indices_with_custom" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestTaskSOPPromptWithCustomization" name="test_system_prompt_without_customization" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestTaskSOPPromptWithCustomization" name="test_system_prompt_with_customization" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestTaskSOPPromptWithCustomization" name="test_system_prompt_customization_appended_not_replaced" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestProjectConfigIntegration" name="test_project_config_with_custom_rules" time="0.001" /><testcase classname="tests.llm.test_sop_customization.TestProjectConfigIntegration" name="test_project_config_without_custom_rules" time="0.001" /><testcase classname="tests.schema.test_result" name="test_result_class" time="0.001" /><testcase classname="tests.service.test_block_nav.TestBlockNav" name="test_list_paths_under_block_basic" time="0.398" /><testcase classname="tests.service.test_block_nav.TestBlockNav" name="test_list_paths_empty_space" time="0.155" /><testcase classname="tests.service.test_block_nav.TestBlockNav" name="test_get_path_info_by_id_basic" time="0.232" /><testcase classname="tests.service.test_block_nav.TestBlockNav" name="test_read_blocks_from_par_id" time="0.230" /><testcase classname="tests.service.test_block_render.TestRenderSOPBlock" name="test_render_sop_block_with_tool_sops" time="0.246" /><testcase classname="tests.service.test_block_render.TestRenderSOPBlock" name="test_render_sop_block_no_tool_sops" time="0.196" /><testcase classname="tests.service.test_block_render.TestRenderSOPBlock" name="test_render_sop_block_empty_preferences" time="0.195" /><testcase classname="tests.service.test_block_render.TestRenderSOPBlock" name="test_render_sop_block_order_preserved" time="0.302" /><testcase classname="tests.service.test_block_render.TestRenderTextBlock" name="test_render_text_block_with_notes" time="0.189" /><testcase classname="tests.service.test_block_render.TestRenderTextBlock" name="test_render_text_block_empty_notes" time="0.189" /><testcase classname="tests.service.test_block_render.TestRenderContentBlock" name="test_render_content_block_sop" time="0.195" /><testcase classname="tests.service.test_block_render.TestRenderContentBlock" name="test_render_content_block_text" time="0.188" /><testcase classname="tests.service.test_block_render.TestRenderContentBlock" name="test_render_content_block_unsupported_type" time="0.159" /><testcase classname="tests.service.test_block_search.TestBlockSearch" name="test_search_path_blocks_basic" time="0.214" /><testcase classname="tests.service.test_block_write_data.TestPageBlock" name="test_create_new_page_success" time="0.236" /><testcase classname="tests.service.test_block_write_data.TestPageBlock" name="test_create_new_page_with_props" time="0.182" /><testcase classname="tests.service.test_block_write_data.TestPageBlock" name="test_create_new_page_with_parent" time="0.229" /><testcase classname="tests.service.test_block_write_data.TestPageBlock" name="test_create_new_page_invalid_parent" time="0.166" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_with_tool_sops" time="0.233" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_preferences_only" time="0.203" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_reuses_existing_tool_reference" time="0.230" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_multiple_with_sort" time="0.247" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_empty_data_fails" time="0.192" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_empty_tool_name_fails" time="0.195" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_tool_name_case_insensitive" time="0.221" /><testcase classname="tests.service.test_block_write_data.TestSOPBlock" name="test_write_sop_with_after_block_index" time="0.299" /><testcase classname="tests.service.test_block_write_data.TestFindBlockSort" name="test_find_block_sort_no_parent" time="0.197" /><testcase classname="tests.service.test_block_write_data.TestFindBlockSort" name="test_find_block_sort_with_parent" time="0.217" /><testcase classname="tests.service.test_block_write_data.TestFindBlockSort" name="test_find_block_sort_invalid_parent" time="0.225" /><testcase classname="tests.service.test_block_write_data.TestFolderBlock" name="test_create_new_folder_success" time="0.244" /><testcase classname="tests.service.test_block_write_data.TestFolderBlock" name="test_create_nested_folders" time="0.244" /><testcase classname="tests.service.test_block_write_data.TestFolderBlock" name="test_create_page_in_folder" time="0.255" /><testcase classname="tests.service.test_block_write_data.TestFolderBlock" name="test_create_folder_with_props" time="0.206" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_sop_with_folder_parent_fails" time="0.207" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_sop_with_root_parent_fails" time="0.150" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_page_with_page_parent_fails" time="0.197" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_folder_with_page_parent_fails" time="0.188" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_text_block_with_page_parent_success" time="0.206" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_text_block_with_folder_parent_fails" time="0.192" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_text_block_with_root_parent_fails" time="0.151" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_multiple_text_blocks_under_page" time="0.253" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_mixed_children_under_page" time="0.255" /><testcase classname="tests.service.test_block_write_data.TestBlockParentChildRelationships" name="test_deep_folder_nesting" time="0.255" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_page_to_folder_success" time="0.262" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_folder_to_folder_success" time="0.246" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_page_block_not_found" time="0.194" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_invalid_block_type" time="0.233" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_page_to_non_folder_fails" time="0.208" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_page_to_nonexistent_parent_fails" time="0.199" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_folder_to_its_own_child_fails" time="0.352" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_folder_to_itself_fails" time="0.204" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_page_with_children" time="0.257" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_multiple_pages_to_same_folder" time="0.318" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_pages_to_same_folder_with_sort" time="0.289" /><testcase classname="tests.service.test_block_write_data.TestMovePathBlock" name="test_move_page_updates_original_parent_children_sort" time="0.538" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_simple_page" time="0.293" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_folder_with_children" time="0.412" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_nested_folder_structure" time="0.440" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_page_with_sop_blocks" time="0.219" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_block_not_found" time="0.100" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_block_wrong_space" time="0.146" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_block_sort_order_adjustment" time="0.225" /><testcase classname="tests.service.test_block_write_data.TestDeleteBlock" name="test_delete_multiple_blocks_in_sequence" time="0.184" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_page_at_root" time="0.095" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_folder_at_root" time="0.099" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_page_in_folder" time="0.117" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_nested_folders" time="0.137" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_page_in_nested_folders" time="0.130" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_block_caching" time="0.098" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_nonexistent_page" time="0.093" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_nonexistent_folder" time="0.096" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_partial_path_not_exists" time="0.109" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_block_with_leading_slash" time="0.133" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_folder_with_children_counts" time="0.147" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_multiple_pages_different_paths" time="0.146" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_block_with_spaces_in_name" time="0.119" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_block_cache_preserves_across_calls" time="0.121" /><testcase classname="tests.service.test_ctx_find_block.TestSpaceCtxFindBlock" name="test_find_block_same_name_different_folders" time="0.140" /><testcase classname="tests.service.test_sop_custom_rules.TestSOPCustomRules" name="test_custom_rules_storage_and_loading" time="0.116" /><testcase classname="tests.service.test_sop_custom_rules.TestSOPCustomRules" name="test_custom_rules_prompt_generation" time="0.081" /><testcase classname="tests.service.test_sop_custom_rules.TestSOPCustomRules" name="test_default_config_without_custom_rules" time="0.077" /><testcase classname="tests.service.test_space_data.TestSetExperienceConfirmation" name="test_set_experience_confirmation_success" time="0.078" /><testcase classname="tests.service.test_space_data.TestSetExperienceConfirmation" name="test_set_experience_confirmation_multiple" time="0.087" /><testcase classname="tests.service.test_space_data.TestRemoveExperienceConfirmation" name="test_remove_experience_confirmation_success" time="0.087" /><testcase classname="tests.service.test_space_data.TestRemoveExperienceConfirmation" name="test_remove_nonexistent_experience_confirmation" time="0.066" /><testcase classname="tests.service.test_space_data.TestRemoveExperienceConfirmation" name="test_remove_experience_confirmation_isolation" time="0.097" /><testcase classname="tests.service.test_space_data.TestListExperienceConfirmations" name="test_list_experience_confirmations_success" time="0.082" /><testcase classname="tests.service.test_space_data.TestListExperienceConfirmations" name="test_list_experience_confirmations_with_pagination" time="0.100" /><testcase classname="tests.service.test_space_data.TestListExperienceConfirmations" name="test_list_experience_confirmations_empty" time="0.086" /><testcase classname="tests.service.test_space_data.TestListExperienceConfirmations" name="test_list_experience_confirmations_space_isolation" time="0.089" /><testcase classname="tests.service.test_space_data.TestExperienceConfirmationIntegration" name="test_full_lifecycle" time="0.093" /><testcase classname="tests.service.test_space_sop_batching" name="test_space_sop_complete_batches_buffered_items" time="0.100" /><testcase classname="tests.service.test_task_data.TestFetchCurrentTasks" name="test_fetch_all_tasks_success" time="0.083"><failure message="sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) &lt;class 'asyncpg.exceptions.UniqueViolationError'&gt;: duplicate key value violates unique constraint &quot;ix_project_secret_key_hmac&quot;&#10;DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.&#10;[SQL: INSERT INTO projects (secret_key_hmac, secret_key_hash_phc, configs, id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::JSONB, $4::UUID) RETURNING projects.created_at, projects.updated_at]&#10;[parameters: ('test_key_hmac', 'test_key_hash', 'null', UUID('adf54022-6b76-42d0-aca6-6eaa6fe801fd'))]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x7a0c1854a860&gt;
operation = 'INSERT INTO projects (secret_key_hmac, secret_key_hash_phc, configs, id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::JSONB, $4::UUID) RETURNING projects.created_at, projects.updated_at'
parameters = ('test_key_hmac', 'test_key_hash', 'null', UUID('adf54022-6b76-42d0-aca6-6eaa6fe801fd'))

    async def _prepare_and_execute(self, operation, parameters):
        adapt_connection = self._adapt_connection
    
        async with adapt_connection._execute_mutex:
            if not adapt_connection._started:
                await adapt_connection._start_transaction()
    
            if parameters is None:
                parameters = ()
    
            try:
                prepared_stmt, attributes = await adapt_connection._prepare(
                    operation, self._invalidate_schema_cache_asof
                )
    
                if attributes:
                    self.description = [
                        (
                            attr.name,
                            attr.type.oid,
                            None,
                            None,
                            None,
                            None,
                            None,
                        )
                        for attr in attributes
                    ]
                else:
                    self.description = None
    
                if self.server_side:
                    self._cursor = await prepared_stmt.cursor(*parameters)
                    self.rowcount = -1
                else:
&gt;                   self._rows = deque(await prepared_stmt.fetch(*parameters))
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:545: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

&gt;   ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_project_secret_key_hmac"
E   DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.

asyncpg/protocol/protocol.pyx:206: UniqueViolationError

The above exception was the direct cause of the following exception:

self = &lt;sqlalchemy.engine.base.Connection object at 0x7a0c381a0c50&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x7a0bf99f0690&gt;
context = &lt;sqlalchemy.dialects.postgresql.asyncpg.PGExecutionContext_asyncpg object at 0x7a0bf9f9ebe0&gt;
statement = &lt;sqlalchemy.dialects.postgresql.asyncpg.PGCompiler_asyncpg object at 0x7a0c18767d90&gt;
parameters = [('test_key_hmac', 'test_key_hash', 'null', UUID('adf54022-6b76-42d0-aca6-6eaa6fe801fd'))]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
    self._adapt_connection._handle_exception(error)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;AdaptedConnection &lt;asyncpg.connection.Connection object at 0x7a0bf9a2a7b0&gt;&gt;
error = UniqueViolationError('duplicate key value violates unique constraint "ix_project_secret_key_hmac"')

    def _handle_exception(self, error):
        if self._connection.is_closed():
            self._transaction = None
            self._started = False
    
        if not isinstance(error, AsyncAdapt_asyncpg_dbapi.Error):
            exception_mapping = self.dbapi._asyncpg_error_translate
    
            for super_ in type(error).__mro__:
                if super_ in exception_mapping:
                    translated_error = exception_mapping[super_](
                        "%s: %s" % (type(error), error)
                    )
                    translated_error.pgcode = translated_error.sqlstate = (
                        getattr(error, "sqlstate", None)
                    )
&gt;                   raise translated_error from error
E                   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: &lt;class 'asyncpg.exceptions.UniqueViolationError'&gt;: duplicate key value violates unique constraint "ix_project_secret_key_hmac"
E                   DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.

.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;test_task_data.TestFetchCurrentTasks object at 0x7a0c3c58a350&gt;

    @pytest.mark.asyncio
    async def test_fetch_all_tasks_success(self):
        """Test fetching all tasks for a session"""
        db_client = DatabaseClient()
        await db_client.create_tables()
    
        async with db_client.get_session_context() as session:
            # Create test data
            project = Project(
                secret_key_hmac="test_key_hmac", secret_key_hash_phc="test_key_hash"
            )
            session.add(project)
&gt;           await session.flush()

tests/service/test_task_data.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:801: in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4441: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
    self._adapt_connection._handle_exception(error)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;AdaptedConnection &lt;asyncpg.connection.Connection object at 0x7a0bf9a2a7b0&gt;&gt;
error = UniqueViolationError('duplicate key value violates unique constraint "ix_project_secret_key_hmac"')

    def _handle_exception(self, error):
        if self._connection.is_closed():
            self._transaction = None
            self._started = False
    
        if not isinstance(error, AsyncAdapt_asyncpg_dbapi.Error):
            exception_mapping = self.dbapi._asyncpg_error_translate
    
            for super_ in type(error).__mro__:
                if super_ in exception_mapping:
                    translated_error = exception_mapping[super_](
                        "%s: %s" % (type(error), error)
                    )
                    translated_error.pgcode = translated_error.sqlstate = (
                        getattr(error, "sqlstate", None)
                    )
&gt;                   raise translated_error from error
E                   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) &lt;class 'asyncpg.exceptions.UniqueViolationError'&gt;: duplicate key value violates unique constraint "ix_project_secret_key_hmac"
E                   DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.
E                   [SQL: INSERT INTO projects (secret_key_hmac, secret_key_hash_phc, configs, id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::JSONB, $4::UUID) RETURNING projects.created_at, projects.updated_at]
E                   [parameters: ('test_key_hmac', 'test_key_hash', 'null', UUID('adf54022-6b76-42d0-aca6-6eaa6fe801fd'))]
E                   (Background on this error at: https://sqlalche.me/e/20/gkpj)

.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: IntegrityError</failure></testcase><testcase classname="tests.service.test_task_data.TestFetchCurrentTasks" name="test_fetch_tasks_with_status_filter" time="0.110" /><testcase classname="tests.service.test_task_data.TestFetchCurrentTasks" name="test_fetch_tasks_no_results" time="0.081" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_status_success" time="0.112" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_order_success" time="0.105" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_data_success" time="0.110" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_multiple_fields" time="0.116" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_nonexistent_task" time="0.106" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_task_with_none_values" time="0.118" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_task_patch_data_success" time="0.131" /><testcase classname="tests.service.test_task_data.TestUpdateTask" name="test_update_task_patch_data_with_status_and_order" time="0.117" /><testcase classname="tests.service.test_task_data.TestInsertTask" name="test_insert_task_success" time="0.129" /><testcase classname="tests.service.test_task_data.TestInsertTask" name="test_insert_task_with_custom_status" time="0.186" /><testcase classname="tests.service.test_task_data.TestInsertTask" name="test_insert_task_default_status" time="0.136" /><testcase classname="tests.service.test_task_data.TestInsertTask" name="test_insert_task_complex_data" time="0.137" /><testcase classname="tests.service.test_task_data.TestInsertTask" name="test_insert_order_increment" time="0.174" /><testcase classname="tests.service.test_task_data.TestDeleteTask" name="test_delete_task_success" time="0.151" /><testcase classname="tests.service.test_task_data.TestDeleteTask" name="test_delete_nonexistent_task" time="0.130" /><testcase classname="tests.service.test_task_data.TestDeleteTask" name="test_delete_task_cascade_behavior" time="0.174" /><testcase classname="tests.service.test_task_data.TestIntegrationScenarios" name="test_full_task_lifecycle" time="0.203" /><testcase classname="tests.service.test_task_data.TestIntegrationScenarios" name="test_multiple_sessions_isolation" time="0.228" /><testcase classname="tests.service.test_task_data.TestIntegrationScenarios" name="test_ordering_after_updates" time="0.245" /><testcase classname="tests.service.test_task_data.TestAppendProgressToTask" name="test_append_progress_to_null_progresses" time="0.175" /><testcase classname="tests.service.test_task_data.TestAppendProgressToTask" name="test_append_progress_to_existing_progresses" time="0.175" /><testcase classname="tests.service.test_task_data.TestAppendProgressToTask" name="test_append_multiple_progresses_sequentially" time="0.201" /><testcase classname="tests.service.test_task_data.TestAppendProgressToTask" name="test_append_progress_with_empty_array" time="0.161" /><testcase classname="tests.service.test_task_data.TestAppendProgressToTask" name="test_append_progress_with_special_characters" time="0.197" /><testcase classname="tests.service.test_task_data.TestAppendProgressToTask" name="test_append_progress_task_not_found" time="0.134" /><testcase classname="tests.service.test_task_data.TestAppendSopThinkingToTask" name="test_append_sop_thinking_success" time="0.182" /><testcase classname="tests.service.test_task_data.TestAppendSopThinkingToTask" name="test_append_sop_thinking_overwrites_existing" time="0.175" /><testcase classname="tests.service.test_task_data.TestAppendSopThinkingToTask" name="test_append_sop_thinking_task_not_found" time="0.136" /><testcase classname="tests.service.test_task_data.TestAppendSopThinkingToTask" name="test_append_sop_thinking_preserves_other_fields" time="0.171" /><testcase classname="tests.test_api.TestGetLearningStatusEndpoint" name="test_get_learning_status_with_digested_tasks" time="0.149"><failure message="sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) &lt;class 'asyncpg.exceptions.UniqueViolationError'&gt;: duplicate key value violates unique constraint &quot;ix_project_secret_key_hmac&quot;&#10;DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.&#10;[SQL: INSERT INTO projects (secret_key_hmac, secret_key_hash_phc, configs, id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::JSONB, $4::UUID) RETURNING projects.created_at, projects.updated_at]&#10;[parameters: ('test_key_hmac', 'test_key_hash', 'null', UUID('ae13647d-912f-4203-88a8-ef23189ff4e4'))]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x7a0c18379f00&gt;
operation = 'INSERT INTO projects (secret_key_hmac, secret_key_hash_phc, configs, id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::JSONB, $4::UUID) RETURNING projects.created_at, projects.updated_at'
parameters = ('test_key_hmac', 'test_key_hash', 'null', UUID('ae13647d-912f-4203-88a8-ef23189ff4e4'))

    async def _prepare_and_execute(self, operation, parameters):
        adapt_connection = self._adapt_connection
    
        async with adapt_connection._execute_mutex:
            if not adapt_connection._started:
                await adapt_connection._start_transaction()
    
            if parameters is None:
                parameters = ()
    
            try:
                prepared_stmt, attributes = await adapt_connection._prepare(
                    operation, self._invalidate_schema_cache_asof
                )
    
                if attributes:
                    self.description = [
                        (
                            attr.name,
                            attr.type.oid,
                            None,
                            None,
                            None,
                            None,
                            None,
                        )
                        for attr in attributes
                    ]
                else:
                    self.description = None
    
                if self.server_side:
                    self._cursor = await prepared_stmt.cursor(*parameters)
                    self.rowcount = -1
                else:
&gt;                   self._rows = deque(await prepared_stmt.fetch(*parameters))
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:545: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

&gt;   ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_project_secret_key_hmac"
E   DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.

asyncpg/protocol/protocol.pyx:206: UniqueViolationError

The above exception was the direct cause of the following exception:

self = &lt;sqlalchemy.engine.base.Connection object at 0x7a0c18390d10&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x7a0bf8df5090&gt;
context = &lt;sqlalchemy.dialects.postgresql.asyncpg.PGExecutionContext_asyncpg object at 0x7a0bf9d7d040&gt;
statement = &lt;sqlalchemy.dialects.postgresql.asyncpg.PGCompiler_asyncpg object at 0x7a0bf9fc8e10&gt;
parameters = [('test_key_hmac', 'test_key_hash', 'null', UUID('ae13647d-912f-4203-88a8-ef23189ff4e4'))]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
    self._adapt_connection._handle_exception(error)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;AdaptedConnection &lt;asyncpg.connection.Connection object at 0x7a0c187485f0&gt;&gt;
error = UniqueViolationError('duplicate key value violates unique constraint "ix_project_secret_key_hmac"')

    def _handle_exception(self, error):
        if self._connection.is_closed():
            self._transaction = None
            self._started = False
    
        if not isinstance(error, AsyncAdapt_asyncpg_dbapi.Error):
            exception_mapping = self.dbapi._asyncpg_error_translate
    
            for super_ in type(error).__mro__:
                if super_ in exception_mapping:
                    translated_error = exception_mapping[super_](
                        "%s: %s" % (type(error), error)
                    )
                    translated_error.pgcode = translated_error.sqlstate = (
                        getattr(error, "sqlstate", None)
                    )
&gt;                   raise translated_error from error
E                   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: &lt;class 'asyncpg.exceptions.UniqueViolationError'&gt;: duplicate key value violates unique constraint "ix_project_secret_key_hmac"
E                   DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.

.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.test_api.TestGetLearningStatusEndpoint object at 0x7a0c3c632ad0&gt;

    @pytest.mark.asyncio
    async def test_get_learning_status_with_digested_tasks(self):
        """Test learning status with space digested and non-digested tasks"""
        db_client = DatabaseClient()
        await db_client.create_tables()
    
        # Create test data
        async with db_client.get_session_context() as session:
            project = Project(
                secret_key_hmac="test_key_hmac", secret_key_hash_phc="test_key_hash"
            )
            session.add(project)
&gt;           await session.flush()

tests/test_api.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:801: in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4441: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
    self._adapt_connection._handle_exception(error)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;AdaptedConnection &lt;asyncpg.connection.Connection object at 0x7a0c187485f0&gt;&gt;
error = UniqueViolationError('duplicate key value violates unique constraint "ix_project_secret_key_hmac"')

    def _handle_exception(self, error):
        if self._connection.is_closed():
            self._transaction = None
            self._started = False
    
        if not isinstance(error, AsyncAdapt_asyncpg_dbapi.Error):
            exception_mapping = self.dbapi._asyncpg_error_translate
    
            for super_ in type(error).__mro__:
                if super_ in exception_mapping:
                    translated_error = exception_mapping[super_](
                        "%s: %s" % (type(error), error)
                    )
                    translated_error.pgcode = translated_error.sqlstate = (
                        getattr(error, "sqlstate", None)
                    )
&gt;                   raise translated_error from error
E                   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) &lt;class 'asyncpg.exceptions.UniqueViolationError'&gt;: duplicate key value violates unique constraint "ix_project_secret_key_hmac"
E                   DETAIL:  Key (secret_key_hmac)=(test_key_hmac) already exists.
E                   [SQL: INSERT INTO projects (secret_key_hmac, secret_key_hash_phc, configs, id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::JSONB, $4::UUID) RETURNING projects.created_at, projects.updated_at]
E                   [parameters: ('test_key_hmac', 'test_key_hash', 'null', UUID('ae13647d-912f-4203-88a8-ef23189ff4e4'))]
E                   (Background on this error at: https://sqlalche.me/e/20/gkpj)

.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: IntegrityError</failure></testcase><testcase classname="tests.test_api.TestGetLearningStatusEndpoint" name="test_get_learning_status_no_tasks" time="0.325" /><testcase classname="tests.test_api.TestGetLearningStatusEndpoint" name="test_get_learning_status_session_not_connected_to_space" time="0.238" /><testcase classname="tests.test_api.TestGetLearningStatusEndpoint" name="test_get_learning_status_invalid_session_id" time="0.214" /><testcase classname="tests.test_api.TestGetLearningStatusEndpoint" name="test_get_learning_status_all_digested" time="0.307" /></testsuite></testsuites>